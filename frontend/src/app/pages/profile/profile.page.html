<ion-header>
  <ion-toolbar>
    <ion-title>Profilo</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="profile-page">

  <!-- HEADER PROFILO -->
  <div class="profile-header">
    <div class="avatar-wrap">
      <ion-avatar class="avatar">
        <img src="assets/icon/profiloF.png">
      </ion-avatar>
    </div>

    <div class="user-info">
      <h2>{{ user.username || 'Utente' }}</h2>
      <p>{{ user.email || 'Email non disponibile' }}</p>
      <p *ngIf="user.registrationDate" class="registration-date">
        Registrato il: {{ user.registrationDate }}
      </p>
    </div>
  </div>

  <!-- BOX STATISTICHE -->
  <ion-card class="stats-card">
    <ion-card-header>
      <ion-card-title>Le tue statistiche</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <div class="stats-grid">
        <div class="stat-item">
          <ion-icon name="checkmark-circle-outline"></ion-icon>
          <h3>{{ user.completedTasks }}</h3>
          <p>Task completate</p>
        </div>

        <div class="stat-item">
          <ion-icon name="time-outline"></ion-icon>
          <h3>{{ user.totalFocusSessions }}</h3>
          <p>Sessioni focus</p>
        </div>

        <div class="stat-item">
          <ion-icon name="calendar-outline"></ion-icon>
          <h3>{{ user.totalStudyMinutes }} min</h3>
          <p>Studio totale</p>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- BOX OBIETTIVI -->
  <ion-card class="goal-card">
    <ion-card-header>
      <ion-card-title>Obiettivi</ion-card-title>
      <ion-card-subtitle>Stabilisci un target e raggiungilo</ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <div class="goal-row">
        <div class="goal-text">
          <span>Ore di studio / settimana</span>
          <strong>{{ stats.studyHours }}h</strong>
        </div>
        <div class="goal-progress">
          <div class="progress">
            <div class="progress-fill" [style.width.%]="stats.completionPercent"></div>
          </div>
          <span class="percent">{{ stats.completionPercent }}%</span>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- SESSIONI FOCUS -->
  <ion-card class="focus-card">
    <ion-card-header>
      <ion-card-title>Sessioni Focus</ion-card-title>
      <ion-card-subtitle>Ultime 5</ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>

      <ion-spinner *ngIf="isLoadingSessions"></ion-spinner>

      <ion-list *ngIf="!isLoadingSessions && sessions.length > 0">
        <ion-item *ngFor="let s of sessions | slice:0:5">
          <ion-label>
            <h3>{{ s.subject }}</h3>
            <p>{{ s.minutes }} min - {{ s.completed ? 'Completata' : 'Interrotta' }}</p>
            <p class="date">{{ s.day | date:'dd/MM/yyyy HH:mm' }}</p>
          </ion-label>
          <ion-badge [color]="s.completed ? 'success' : 'warning'">
            {{ s.completed ? 'OK' : 'STOP' }}
          </ion-badge>
        </ion-item>
      </ion-list>

      <div *ngIf="!isLoadingSessions && sessions.length === 0" class="empty">
        Nessuna sessione ancora salvata.
      </div>

    </ion-card-content>
  </ion-card>

  <!-- AZIONI -->
  <div class="profile-actions">
    <ion-button class="profile" expand="block" disabled>
      <ion-icon name="person-outline" slot="start"></ion-icon>
      Modifica Profilo
    </ion-button>
    
    <ion-button class="settings" expand="block" disabled>
      <ion-icon name="settings-outline" slot="start"></ion-icon>
      Impostazioni
    </ion-button>
    
    <ion-button class="logout" expand="block" (click)="onLogout()">
      <ion-icon name="log-out-outline" slot="start"></ion-icon>
      Logout
    </ion-button>
  </div>

</ion-content>

<!-- NAV BAR -->
<ion-footer>
  <ion-toolbar>
    <ion-grid>
      <ion-row>
        <ion-col class="tab" [class.active]="activeTab === 'planner'" (click)="navigate('planner')">
          <div class="tab-content">
            <img src="assets/icon/calendario.jpeg" class="logo-image">
            <ion-label>Planner</ion-label>
          </div>
        </ion-col>

        <ion-col class="tab" [class.active]="activeTab === 'stats'" (click)="navigate('stats')">
          <div class="tab-content">
            <img src="assets/icon/statistiche.jpeg" class="logo-image">
            <ion-label>Statistiche</ion-label>
          </div>
        </ion-col>

        <ion-col class="tab" [class.active]="activeTab === 'focus'" (click)="navigate('focus')">
          <div class="tab-content">
            <img src="assets/icon/orologio.jpeg" class="logo-image">
            <ion-label>Focus</ion-label>
          </div>
        </ion-col>

        <ion-col class="tab" [class.active]="activeTab === 'profile'" (click)="navigate('profile')">
          <div class="tab-content">
            <img src="assets/icon/profilo.jpeg" class="logo-image">
            <ion-label>Profilo</ion-label>
          </div>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-toolbar>
</ion-footer>